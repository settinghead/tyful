<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0052)http://www.raymondhill.net/voronoi/rhill-voronoi.php -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>Javascript implementation of Steven J. Fortune's algorithm to compute Voronoi diagrams</title>
<meta name="Keywords" lang="en" content="voronoi, fortune, javascript, raymond hill">
<!--[if lte IE 8]><script type="text/javascript" src="excanvas/excanvas.compiled.js"></script><![endif]-->
<script type="text/javascript" src="./test_files/rhill-voronoi.js"></script>
<style type="text/css">
body {font-family:tahoma,verdana,arial;font-size:13px;margin:0;padding:0}
body > div {margin-left:4px;margin-right:4px;}
body > div > div {margin:0;border:1px solid #ccc;border-top:0;padding:4px;}
h1 {margin:0 0 0.5em 0;padding: 4px 5em 4px 4px;font:bold large sans-serif;background-color:#c9d7f1;}
h4 {font-size:14px;margin:0.5em 0 0 0;border:0;border-bottom:solid 1px #c9d7f1;padding:2px;background-color:#e5ecf9;}
h4 > span {cursor:pointer}
textarea {font-size:11px;color:gray}
table {padding:0;border:1px solid #eee}
table tr:first-child {background-color:#e4f4e4;font-weight:bold;}
table tr:first-child ~ tr:nth-child(odd) {background-color:#f4f4f4}
table td {margin:0;padding:2px;border:0;vertical-align:top;background-color:transparent;}
#canvasParent {margin-top:0;margin-bottom:1em;padding:0;border:0}
</style>
</head>
<body onload="Voronoi.init();" class=" hasGoogleVoiceExt">
	<a href="http://github.com/gorhill/Javascript-Voronoi"><img style="position:absolute;top:0;right:0;border:0;" src="./test_files/687474703a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f72696768745f6461726b626c75655f3132313632312e706e67" alt="Fork me on GitHub"></a>
	<h1>Javascript implementation of Steven J. Fortune's algorithm to compute Voronoi diagrams</h1>
	<div id="divroot" style="width:800px;">
		<p style="margin-top:0;"><a href="http://www.raymondhill.net/">&lt; Home page of Raymond Hill</a> | <a href="http://www.raymondhill.net/voronoi/rhill-voronoi-demo1.php">Demo 1: measuring peformance</a> | <a href="http://www.raymondhill.net/voronoi/rhill-voronoi-demo2.php">Demo 2: a bit of interactivity</a> | <a href="http://www.raymondhill.net/voronoi/rhill-voronoi-demo3.php">Demo 3: Fancy tiling</a> | <a href="http://www.raymondhill.net/blog/?p=458#comments">Comments</a></p>
		<h4 class="divhdr">Intro</h4>
		<div class="divinfo" id="voronoiIntro">
			<p>See my <a href="http://www.raymondhill.net/blog/?p=458">blog post</a> regarding this page. This page uses an out of date version (and customized to serve as a tutorial of Fortune's algorithm) of the Javascript Voronoi object. However the demo pages listed above use the latest version.</p>
		</div>
		<h4 class="divhdr">Sites generator <span id="voronoiGeneratorCollapse">▵</span></h4>
		<div class="divinfo" id="voronoiGenerator">
			<input type="button" value="Generate" onclick="Voronoi.clearSites();Voronoi.generateSites(parseInt(document.getElementById(&#39;voronoiNumberSites&#39;).value,10));"> or <input type="button" value="Add" onclick="Voronoi.generateSites(parseInt(document.getElementById(&#39;voronoiNumberSites&#39;).value,10));"><input id="voronoiNumberSites" type="text" value="100" size="5" maxlength="5"> sites randomly (Warning: performance might suffer the more sites you add.)<br>
			<div style="display:inline-block;vertical-align:top;"><input id="voronoiParseSites" type="button" value="Parse as sites" onclick="Voronoi.parseSites(document.getElementById(&#39;voronoiUserInput&#39;).value);"><br>
				<input id="voronoiParseLattices" type="button" value="Parse as lattices" onclick="Voronoi.parseLattices(document.getElementById(&#39;voronoiUserInput&#39;).value);"></div>
				<div style="display:inline-block;vertical-align:top;"><textarea id="voronoiUserInput" rows="4" cols="80">Any non-digit character is interpreted as a separator. Sites: The input is scanned for consecutive pairs of values which are interpreted as (x,y). Lattices: The input is scanned for consecutive quadruplets of values which are interpreted as (offset x, offset y, delta x, delta y). Example, try: 0,0,60,100,30,50,60,100</textarea></div>
				<input id="voronoiClearSites" type="button" value="Clear all sites" onclick="Voronoi.clearSites();">
			</div>
			<h4 class="divhdr">Canvas <span id="voronoiCanvasControlsCollapse">▵</span></h4>
			<div id="voronoiCanvasControls">
				<div style="width:80%;margin:0;border:0;display:inline-block;vertical-align:top;"><input id="voronoiCanvasSize" type="button" value="Set" onclick="Voronoi.setCanvasSize(parseInt(document.getElementById(&#39;voronoiWidth&#39;).value,10),parseInt(document.getElementById(&#39;voronoiHeight&#39;).value,10));Voronoi.setCanvasMargin(parseInt(document.getElementById(&#39;voronoiCanvasMargin&#39;).value,10));document.getElementById(&#39;divroot&#39;).style.width=String(Math.max(Voronoi.canvas.width,800))+&#39;px&#39;"> canvas W × H to <input id="voronoiWidth" type="text" value="800" size="4" maxlength="4"> pixels × <input id="voronoiHeight" type="text" value="600" size="4" maxlength="4"> pixels, with a margin of <input id="voronoiCanvasMargin" type="text" value="0" size="2" maxlength="2"> pixels.</div>
				<div style="width:19%;margin:0;border:0;display:inline-block;vertical-align:top;text-align:right">
					<input id="voronoiColourize" type="button" value="Colourize" onclick="Voronoi.drawCells();"></div>
				</div>
				<div id="canvasParent">
					<noscript>You need to enable Javascript in your browser for this page to display properly.</noscript>
					<canvas id="voronoiCanvas" style="cursor:crosshair" width="800" height="600"></canvas>
					<div id="voronoiNoCanvasAlert" style="display:none;padding:1em;background-color:#fcc;color:black;">
						<p>Your browser doesn't support the HTML5 &lt;canvas&gt; element technology.</p>
						<p>See <a target="_blank" href="http://en.wikipedia.org/wiki/Canvas_(HTML_element)">Wikipedia</a> for information on which browsers support the <u>HTML5 &lt;canvas&gt;</u> technology.</p>
					</div>
				</div>
				<h4 class="divhdr">Event queue</h4>
				<div class="divinfo">
					<div style="width:49%;margin:0;border:0;display:inline-block;">
						<input id="voronoiProcessAll" type="button" value="Process all" onclick="Voronoi.processQueueAll();"><br>
						<input id="voronoiProcessOne" type="button" value="Process one" onclick="Voronoi.processQueueOne();Voronoi.draw();Voronoi.dumpBeachline();"> (down arrow works too)<br>
						<input id="voronoiProcessNDo" type="button" value="Process" onclick="Voronoi.processQueueN(parseInt(document.getElementById(&#39;voronoiProcessN&#39;).value,10));Voronoi.draw();Voronoi.dumpBeachline();"> <input id="voronoiProcessN" type="text" value="10" size="4" maxlength="4"><br>
						<input id="voronoiReset" type="button" value="Reset" onclick="Voronoi.reset();">
					</div>
					<div style="width:49%;margin:0;border:0;display:inline-block;vertical-align:top">
						<input id="voronoiMoveSweepline" type="button" value="Move sweep line" onclick="Voronoi.processUpTo(Voronoi.sweep+parseInt(document.getElementById(&#39;voronoiMoveSweeplineN&#39;).value,10));Voronoi.draw();Voronoi.dumpBeachline();"> <input id="voronoiMoveSweeplineN" type="text" value="4" size="3" maxlength="3"> pixel(s)<br>
						<input id="voronoiAnimateSweepline" type="button" value="Animate sweep line" onclick="VoronoiAnimate(parseInt(document.getElementById(&#39;voronoiMoveSweeplineN&#39;).value,10),parseInt(document.getElementById(&#39;voronoiAnimateSweeplineDelay&#39;).value,10));document.getElementById(&#39;voronoiAnimateSweeplineDelay&#39;).value=VoronoiAnimateDelay;"> every <input id="voronoiAnimateSweeplineDelay" type="text" value="100" size="4" maxlength="4"> ms <input id="voronoiAnimateSweeplineStop" type="button" value="Stop" onclick="VoronoiAnimateStop();"><br></div>
					</div>
					<h4 class="divhdr">Scrutinize...</h4>
					<div class="divinfo">
						<!-- <input id="voronoiDumpBeachline" type="button" value="Examine beachline"/>&nbsp;<input id="voronoiDumpVertices" type="button" value="Examine vertices"/>&nbsp;<input id="voronoiDumpEdges" type="button" value="Examine edges"/>&nbsp;<input id="voronoiDumpPolygons" type="button" value="Examine polygons"/> -->
						Red beach sections are collapsing (meaning there is a Fortune circle event associated with them), while green beach sections are expanding. When all the Fortune events have been processed, a beachline most likely still exists, which means the start and/or end points of the edges implied by each pair of beach sections are not connected, in which case we must ‘manually’ connect these dangling lines to the bounding box, or discard them if they are outside the viewport.
						<div id="console" style="margin-top:1em;margin-bottom:0;margin-left:1em;margin-right:0">Total number of sites processed: 2985<br>Number of binary searches: 8911<br>Avg number of iterations per binary search: 5.90<br>Number of parabolic cut calculations: 63120 out of 85968 total<br>Average beachline size: 116.73<br>Average circle event queue size: 175.56<br>Total number of cancelled circle events: 4629 out of 10555 total (44%)<br>Largest circle events queue size: 267 events<br>Number of destroyed edges (outside the viewport): 173 out of a total of 8926 edges<br><br>Beachline is composed of 18 beach sections:<br><span style="margin-left:2em;color:#ccc">edge: none</span><br><span style="color:#080">xl=<b>-Infinity</b>, xr=<b>-1351799.2738</b>, site={id:1320, x:<b>42</b>, y:<b>0</b>}</span><br><span style="margin-left:2em;color:#888">edge: id=undefined</span><br><span style="color:#080">xl=<b>-1351799.2738</b>, xr=<b>-773348.8686</b>, site={id:1567, x:<b>13</b>, y:<b>3</b>}</span><br><span style="margin-left:2em;color:#888">edge: id=undefined</span><br><span style="color:#080">xl=<b>-773348.8686</b>, xr=<b>-70503.0412</b>, site={id:2668, x:<b>2</b>, y:<b>5</b>}</span><br><span style="margin-left:2em;color:#888">edge: id=undefined</span><br><span style="color:#080">xl=<b>-70503.0412</b>, xr=<b>-70295.4270</b>, site={id:1997, x:<b>1</b>, y:<b>91</b>}</span><br><span style="margin-left:2em;color:#888">edge: id=undefined</span><br><span style="color:#080">xl=<b>-70295.4270</b>, xr=<b>-69173.5000</b>, site={id:1993, x:<b>0</b>, y:<b>191</b>}</span><br><span style="margin-left:2em;color:#888">edge: id=undefined</span><br><span style="color:#080">xl=<b>-69173.5000</b>, xr=<b>-66443.5618</b>, site={id:509, x:<b>1</b>, y:<b>569</b>}</span><br><span style="margin-left:2em;color:#888">edge: id=undefined</span><br><span style="color:#080">xl=<b>-66443.5618</b>, xr=<b>-1330.2766</b>, site={id:2783, x:<b>2</b>, y:<b>594</b>}</span><br><span style="margin-left:2em;color:#888">edge: id=undefined</span><br><span style="color:#080">xl=<b>-1330.2766</b>, xr=<b>-184.2941</b>, site={id:1558, x:<b>102</b>, y:<b>598</b>}</span><br><span style="margin-left:2em;color:#888">edge: id=undefined</span><br><span style="color:#080">xl=<b>-184.2941</b>, xr=<b>473.5000</b>, site={id:151, x:<b>285</b>, y:<b>600</b>}</span><br><span style="margin-left:2em;color:#888">edge: id=undefined</span><br><span style="color:#080">xl=<b>473.5000</b>, xr=<b>2161.7909</b>, site={id:55, x:<b>662</b>, y:<b>600</b>}</span><br><span style="margin-left:2em;color:#888">edge: id=undefined</span><br><span style="color:#080">xl=<b>2161.7909</b>, xr=<b>22948.3571</b>, site={id:2209, x:<b>782</b>, y:<b>595</b>}</span><br><span style="margin-left:2em;color:#444">edge: id=141929, start=(x:<b>787.0</b>, y:<b>587.2</b>), end=(x:<b>796.1</b>, y:<b>600.0</b>)</span><br><span style="color:#080">xl=<b>22948.3571</b>, xr=<b>63393.2258</b>, site={id:2428, x:<b>796</b>, y:<b>585</b>}</span><br><span style="margin-left:2em;color:#444">edge: id=141796, start=(x:<b>789.6</b>, y:<b>569.2</b>), end=(x:<b>800.0</b>, y:<b>570.3</b>)</span><br><span style="color:#080">xl=<b>63393.2258</b>, xr=<b>69901.1148</b>, site={id:1931, x:<b>799</b>, y:<b>555</b>}</span><br><span style="margin-left:2em;color:#888">edge: id=undefined</span><br><span style="color:#080">xl=<b>69901.1148</b>, xr=<b>70338.4777</b>, site={id:239, x:<b>800</b>, y:<b>255</b>}</span><br><span style="margin-left:2em;color:#888">edge: id=undefined</span><br><span style="color:#080">xl=<b>70338.4777</b>, xr=<b>74773.0091</b>, site={id:620, x:<b>800</b>, y:<b>143</b>}</span><br><span style="margin-left:2em;color:#888">edge: id=undefined</span><br><span style="color:#080">xl=<b>74773.0091</b>, xr=<b>739533.6793</b>, site={id:1228, x:<b>792</b>, y:<b>10</b>}</span><br><span style="margin-left:2em;color:#888">edge: id=undefined</span><br><span style="color:#080">xl=<b>739533.6793</b>, xr=<b>6486947.7920</b>, site={id:464, x:<b>750</b>, y:<b>2</b>}</span><br><span style="margin-left:2em;color:#888">edge: id=undefined</span><br><span style="color:#080">xl=<b>6486947.7920</b>, xr=<b>Infinity</b>, site={id:2517, x:<b>657</b>, y:<b>0</b>}</span><br></div>
					</div>
					<h4 class="divhdr">Portions of this software are based on, or depend on, or are inspired from the work of...</h4>
					<div class="divinfo">
						<ul style="margin-top:0;margin-bottom:0">
							<li><a target="_blank" href="http://en.wikipedia.org/wiki/Fortune%27s_Algorithm">“Fortune's algorithm”</a> by <a href="http://ect.bell-labs.com/who/sjf/">Steven Fortune</a>: For his clever algorithm to compute Voronoi diagrams. (<a href="http://ima.udg.es/~sellares/ComGeo/Vor2D_1.ppt">Powerpoint detailing the algorithm</a>)</li>
							<li><a href="http://alecmce.com/as3/parabolas-and-quadratic-bezier-curves">Alec McEachran's code</a> to translate a parabola's focal &amp; directrix into parameters for <a href="http://en.wikipedia.org/wiki/Canvas_element">html5 <code>&lt;canvas&gt;</code></a>' <code>quadraticCurveTo()</code> method. It occurred to me I could use a <a href="http://en.wikipedia.org/wiki/B%C3%A9zier_curve">Bézier curve</a> to draw a parabolic front, and when I plugged "bézier from focus directrix" in a search engine to find out if someone already went through this, Alec's site was on the first page of results, and his tutorial and <a href="http://github.com/alecmce/as3geometry/blob/master/src/as3geometry/geom2D/ui/ParabolaDrawer.as">accompanying code</a> worked like a charm. His code allows for parabolas with any orientation, so it could be simplified for the current case where parabolas are always oriented vertical and upward.</li>
							<li><a target="_blank" href="http://www.skytopia.com/project/articles/compsci/clipping.html">“The Liang-Barsky line clipping algorithm in a nutshell!”</a>, to efficiently clip a line within a rectangle.</li>
<!--[if IE]>
<li><a href="http://code.google.com/p/explorercanvas/">excanvas.js</a>: To simulate support of HTML5 <a href="http://en.wikipedia.org/wiki/Canvas_element"><code>&lt;canvas&gt;</code></a> element in Microsoft's Internet Explorer.</li>
<![endif]-->
</ul>
</div>
</div>
<script type="text/javascript">
<!--
(function(){
	var els=document.querySelectorAll('h4 > span');
	for (var i=0; i<els.length; i++){
		var el=els[i];
		el.onclick=function(){
			var id=this.id.replace('Collapse','');
			var div=document.getElementById(id);
			var expanded=div.style.display=='';
			div.style.display=expanded?'none':'';
			this.innerHTML=expanded?'&#9663;':'&#9653;';
		};
	}
})();
// -->
</script>


</body></html>