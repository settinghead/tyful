

<% if @template.errors.any? %>
<div id="error_explanation">
	<h2><%= pluralize(@template.errors.count, "error") %> prohibited this template from being saved:</h2>

	<ul>
		<% @template.errors.full_messages.each do |msg| %>
		<li><%= msg %></li>
		<% end %>
	</ul>
</div>
<% end %>

<div class="row-fluid">
	<div class="span12" style="height: 100%;">

		<%if can? :manage, @template%>
		<script type="text/javascript">
// window.onbeforeunload = function(){
// 	var message = "There might be unsaved changes to your template. Are you sure you want to navigate away from this page? ",
// 	  e = e || window.event;
// 	  // For IE and Firefox
// 	  if (e) {
// 	    e.returnValue = message;
// 	  }
// 
// 	  // For Safari
// 	  return message;}


</script>
<%end%>
<div class="row-fluid" style="text-align:center;">
	<div class="span9">
		<ul class="nav nav-tabs" id="tyfulTabs">
			<li class="active"><a href="#draw" id="drawButton" data-toggle="tab">Draw</a></li>
			<li><a href="#adjust" id="adjustButton" data-toggle="tab">Adjust</a></li>
			<li><a href="#share" id="shareButton" data-toggle="tab">Share</a></li>
		</ul>
		<div class="tab-content">
			<div class="tab-pane active" id="draw">
				<div id="mainCanvas">
					<canvas id="sketchBuffer" style="display: none;"></canvas>
					<canvas id="directionIndicator" style="display: none;"></canvas>
					<canvas id="direction" style="display: none;"></canvas>
					<canvas id="sketch" width="1000" height="750" style="background-image: url(<%=image_path 'transparent-background-tile.png'%>);"></canvas>
					<img id="loader" class="hidden">

					<div class="drawing-tools floating-toolbar">
						<a href="#sketch" data-tool="marker">Marker</a>
						<a href="#sketch" data-tool="eraser">Eraser</a>
						<div style="display: inline-block;">
							<input class="knob" data-width="60" data-cursor="true"
							data-thickness="0.3" data-angleOffset="90"
 data-min="0" data-max="360" data-width="50" data-step="2" data-height="70" data-fgcolor="#222222" data-bgcolor="#999999" style="width:79px;height:50px"/>
						</div>
						<!--http://www.script-tutorials.com/demos/206/index.html-->
						<div style="display: inline-block;">
							<canvas id="color" width="300" height="50"></canvas>
						</div>
						<div style="display: inline-block;">
							<div>Preview:</div>
							<div id="preview"></div>
							<div id="pick"></div>
						</div>
					</div>
				</div>
			</div>
			<div class="tab-pane" id="adjust">
					<div id="render-editor" class="frame" style="width: 100%; height: 100%; overflow: scroll;">
						<canvas id="renderer"></canvas>
					</div>
					<div class="floating-toolbar" id="object-editor">
						<input class="fontselect" type="text" />
					</div>
			</div>

			<div class="tab-pane" id="share">Share your Tyful artwork </div>
		</div>
	</div>
	<div class="span3">
		<div class="affix" style="padding: 10px;">
			<ul class="nav nav-tabs" id="sidebarTabs">
				<li class="active"><a href="#draw" id="drawButton">Insert</a></li>
				<li><a href="#adjust" id="adjustButton">Words</a></li>
				<li><a href="#share" id="shareButton">Fonts</a></li>
				<li><a href="#share" id="shareButton">Color</a></li>
			</ul>
			<div id="object-editor">

			</div>
			<div id="renderpreview-container">
				<canvas id="renderpreview" class="thumb zoomtransition"></canvas>
			</div>

			<div>
				<button type="button" class="btn btn-success btnModify" data-loading-text="Loading...">Fill in Blanks</button>
				<button type="button" class="btn btn-success btnRegenerate" data-loading-text="Loading...">Redraw</button>
			</div>
			<div id="shopping-area">
				<div class="row-fluid">
					<div class="span6">
						<canvas width="900" height="900" class="shopping-window zoomtransition"/>
					</div>
					<div class="span6">
						<canvas width="900" height="900" class="shopping-window zoomtransition"/>
					</div>
				</div>
				<div class="row-fluid">
					<div class="span6">
						<canvas width="900" height="900" class="shopping-window zoomtransition"/>

					</div>
					<div class="span6">
						<canvas width="900" height="900" class="shopping-window zoomtransition"/>

					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<%if can? :manage, @template %>
<div id="modal">
	<%= form_for(@template,:remote => true) do |f| %>
	  <%= f.error_messages %>
	
	<div class="field">
		<%if (current_user && (not current_user.nickname)) %>

		<%= label_tag "Pick an artist name for yourself" %> 
		<%= text_field_tag 'nickname' %>
		<%end%>
	</div>

	<div class="field">
		<%= f.label :name, "Template name" %>
		<%= f.text_field :name %>
	</div>
	<div class="field">
		<%= f.label :description %><br />
		<%= f.text_area :description, :rows => 10, :cols => 40 %>
	</div>
	<div class="field">
		<%= f.label :private, "Make this template private" %>
		<%= f.check_box :private %>
	</div>
	
	<%= f.hidden_field :uuid %>

	<div class="actions">
		<%= f.submit %>
	</div>
	<% end %>
</div>
<%end%>
</div>

</div>

<div id="listener">
	<embed name="nacl_module"
	id="tyful_nacl_client"
	width=0 height=0
	src="/tyful_nacl_client.nmf"
	type="application/x-nacl" />
</div>